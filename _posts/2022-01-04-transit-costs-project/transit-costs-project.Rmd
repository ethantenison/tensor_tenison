---
title: "Transit Costs Project"
description: |
  A short description of the post.
author:
  - name: Ethan Tenison
    url: https://twitter.com/ethantenison
date: 01-04-2022
output:
  distill::distill_article:
    self_contained: false
---

# Transit Costs Project 

This data comes from the [Transit Costs Project](https://transitcosts.com/) via `#tidytuesday` on Twitter.

>Why do transit-infrastructure projects in New York cost 20 times more on a per kilometer basis than in Seoul? We investigate this question across hundreds of transit projects from around the world. We have created a database that spans more than 50 countries and totals more than 11,000 km of urban rail built since the late 1990s. We will also examine this question in greater detail by carrying out six in-depth case studies that take a closer look at unique considerations and variables that arenâ€™t easily quantified, like project management, governance, and site conditions.

>The goal of this work is to figure out how to deliver more high-capacity transit projects for a fraction of the cost in countries like the United States. Additionally, we hope that our site will be a useful resource for elected officials, planners, researchers, journalists, advocates, and others interested in contextualizing transit-infrastructure costs and fighting for better projects.

One of the reason why I chose it was because the city I live in, Austin, approved a massive expansion of its rail transit-system. From the beginning of the planning process (a different version was defeat once before), it was highly controversial partly because of the cost. Given the congestion on Austin's roads already, it doesn't seem like the city has any other viable option to alleviate the problem. 


```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)


```

```{r data, echo = TRUE}

library(tidytuesdayR)
library(tidyverse
        )

tuesdata <- tidytuesdayR::tt_load(2021, week = 2)

transit_cost <- tuesdata$transit_cost
glimpse(transit_cost)

```

The data set contains twenty variables including start and end date, track length, number of stations, whether it contains a tunnel, and cost recalculated using different measures. 

# Average cost per country

As mentioned below, the United States is by far the most expensive place to built transit systems. Hopefully we'll be able to discover exactly why that is, but I have a feeling we're missing some crucial variables. 

```{r total_cost}

total <- transit_cost |> 
  group_by(country) |> 
  summarize(average_cost = mean(cost_km_millions)) |> 
  filter(!is.na(average_cost),
         !is.na(country)) |> 
  mutate(us = case_when(
    country == "US" ~ "1",
    country == "CN" ~ "1",
    TRUE ~ "0"
  ))

theme_set(theme_classic())

ggplot(total, aes(x = reorder(country, -average_cost), y = average_cost, fill = us)) +
  geom_bar(stat = "identity") +
  scale_fill_manual( values = c( "1"="red", "0"="darkgray" ), guide = FALSE )+
  labs( x = "Country",
        y = "Average cost per km",
        title = "Average rail cost per km by country",
        subtitle = "(Millions $USD)", 
        caption = "Source: Transit Costs Project") +
  geom_curve(x = 8.5, y = 1100,
             xend = 2, yend = 1000,
             color = "black",
             curvature = 0.2,
             size = 1.5,
             arrow = arrow()) +
  annotate(
      "text",
      x = 18,
      y = 1000,
      label = expression("The United States pays the most\n in the world per kilometer of rail\n at $1211.46 million per kilometer"),
      size = 3.5
   ) +
  geom_curve(x = 40, y = 350,
             xend = 38, yend = 200,
             color = "black",
             curvature = 0.2,
             size = 1.5,
             arrow = arrow()) +
  annotate(
      "text",
      x = 48,
      y = 350,
      label = expression("China only spends on\n average $184.39 million"),
      size = 3.5
   ) +
  annotate("text", 
           x = 1.2,
           y = -30,
           label = "US", 
           size = 3.5) +
  annotate("text", 
           x = 38,
           y = -30,
           label = "CN", 
           size = 3.5) +
  theme(
    axis.text.x = element_blank(),
    title = element_text(hjust = 0.5),
    axis.ticks.x=element_blank(),
    axis.line.x = element_blank(),
    axis.line.y = element_blank()
  )

```

# Total Lines per country 

Although I some transit lines are not accounted for in this data set, namely Austin's red line, it is indisputable that China is the global leader in rail construction over the past 30 years. This partially because China started from an extremely low level of infrastructure and because of Chinese government intervention. Given that the Chinese construction and real estate industries are bordering on insolvency because of over investment, the same may be true for transit. That question we certainly can't answer from this data set though!  

```{r total_lines}

total_lines <- transit_cost |> 
  group_by(country) |>
  count() |> 
  filter(!is.na(country)) |> 
  mutate(us = case_when(
    country == "CN" ~ "1",
    country == "US" ~ "1",
    TRUE ~ "0"
  ))

ggplot(total_lines, aes(x = reorder(country, -n), y = n, fill = us)) +
  geom_bar(stat = "identity") +
  scale_fill_manual( values = c( "1"="red", "0"="darkgray" ), guide = FALSE ) +
  labs( x = "Countries",
        y = "Rail lines built",
        title = "Total rail lines built per country",
        caption = "Source: Transit Costs Project") +
  theme(
    axis.text.x = element_blank(),
    title = element_text(hjust = 0.5),
    axis.ticks.x=element_blank() ,
    axis.line.x = element_blank(),
    axis.line.y = element_blank()
  ) +
  geom_curve(x = 10, y = 175,
             xend = 2, yend = 150,
             color = "black",
             curvature = 0.2,
             size = 1.5,
             arrow = arrow()) +
  annotate(
      "text",
      x = 17,
      y = 170,
      label = expression("By far, China built the\n most rail since 1990."),
      size = 3.5
   ) +
  annotate("text", 
           x = 1.3,
           y = -8,
           label = "CN", 
           size = 3.5) +
  annotate("text", 
           x = 8,
           y = -8,
           label = "US", 
           size = 3.5)

```


# What is causing rail to be so expensive in the US? 

Let's take a deeper look how the different variables are correlated with each other. 

```{r correlation}

cor <- transit_cost |>
  filter(!is.na(end_year)) |> # this removes 71
  mutate(
    end_year = as.numeric(end_year),
    start_year = as.numeric(start_year),
    real_cost = as.numeric(real_cost),
    total_years = end_year - start_year,
    non_tunnel = length - tunnel
  ) |>
  select(
    -c(
      1:4,
      source1,
      source2,
      reference,
      length,
      tunnel_per,
      cost,
      currency,
      ppp_rate,
      cost_km_millions, 
      start_year,
      end_year
    )
  )

#cor <- na.omit(cor)

library(corrplot)
Correlation <- cor(cor, use="pairwise.complete.obs")
corrplot(Correlation, order = 'hclust', addrect = 2)

```


# Linear Regression 

Unfortunately, with the current variables available, we can not make accurate predictions on cost per km, but with real cost as the dependent variable we get some good explanatory power. 

```{r linear_regression}
library(tidymodels)

# Specifying the model 
lm_spec <- linear_reg() %>%
  set_mode("regression") %>%
  set_engine("lm")

lm_fit <- lm_spec %>%
  fit(real_cost ~ ., data = cor)

lm_fit %>% 
  pluck("fit") %>%
  summary()


```

