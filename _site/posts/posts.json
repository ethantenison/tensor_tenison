[
  {
    "path": "posts/2022-01-04-transit-costs-project/",
    "title": "Transit Costs Project",
    "description": "A short description of the post.",
    "author": [
      {
        "name": "Ethan Tenison",
        "url": "https://twitter.com/ethantenison"
      }
    ],
    "date": "2022-01-04",
    "categories": [],
    "contents": "\r\n\r\nContents\r\nTransit Costs Project\r\nDownloading the data\r\nSneak Peak\r\n\r\nLets map it !\r\nGeocoding with ggmap\r\nPlotting projects on a world map\r\n\r\nAverage cost per country\r\nTotal Lines per country\r\nWhat is causing rail to be so expensive in the US?\r\nLinear Regression\r\nPrediction\r\nData splitting\r\nTraining\r\nEvaluating\r\n\r\nVariable Importance\r\nCheck for accuracy\r\nRandom Forest\r\n\r\n\r\nTransit Costs Project\r\nThis data comes from the Transit Costs Project via #tidytuesday on Twitter.\r\n\r\nWhy do transit-infrastructure projects in New York cost 20 times more on a per kilometer basis than in Seoul? We investigate this question across hundreds of transit projects from around the world. We have created a database that spans more than 50 countries and totals more than 11,000 km of urban rail built since the late 1990s. We will also examine this question in greater detail by carrying out six in-depth case studies that take a closer look at unique considerations and variables that aren’t easily quantified, like project management, governance, and site conditions.\r\n\r\n\r\nThe goal of this work is to figure out how to deliver more high-capacity transit projects for a fraction of the cost in countries like the United States. Additionally, we hope that our site will be a useful resource for elected officials, planners, researchers, journalists, advocates, and others interested in contextualizing transit-infrastructure costs and fighting for better projects.\r\n\r\nOne of the reason why I chose it was because the city I live in, Austin, approved a massive expansion of its rail transit-system. From the beginning of the planning process (a different version was defeat once before), it was highly controversial partly because of the cost. Given the congestion on Austin’s roads already, it doesn’t seem like the city has any other viable option to alleviate the problem.\r\nDownloading the data\r\n\r\n\r\nShow code\r\n\r\nlibrary(tidytuesdayR)# tidytuesday data package \r\nlibrary(tidyverse)   # compendium of data lifecycle packages\r\nlibrary(vip)         # for visualizing variable importance\r\nlibrary(dotwhisker)  # for visualizing regression \r\n\r\ntuesdata <- tidytuesdayR::tt_load(2021, week = 2)\r\n\r\n\r\n\r\n    Downloading file 1 of 1: `transit_cost.csv`\r\n\r\nSneak Peak\r\n\r\n\r\nShow code\r\n\r\ntransit_cost <- tuesdata$transit_cost\r\nglimpse(transit_cost)\r\n\r\n\r\nRows: 544\r\nColumns: 20\r\n$ e                <dbl> 7136, 7137, 7138, 7139, 7144, 7145, 7146, 7~\r\n$ country          <chr> \"CA\", \"CA\", \"CA\", \"CA\", \"CA\", \"NL\", \"CA\", \"~\r\n$ city             <chr> \"Vancouver\", \"Toronto\", \"Toronto\", \"Toronto~\r\n$ line             <chr> \"Broadway\", \"Vaughan\", \"Scarborough\", \"Onta~\r\n$ start_year       <chr> \"2020\", \"2009\", \"2020\", \"2020\", \"2020\", \"20~\r\n$ end_year         <chr> \"2025\", \"2017\", \"2030\", \"2030\", \"2030\", \"20~\r\n$ rr               <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0~\r\n$ length           <dbl> 5.7, 8.6, 7.8, 15.5, 7.4, 9.7, 5.8, 5.1, 4.~\r\n$ tunnel_per       <chr> \"87.72%\", \"100.00%\", \"100.00%\", \"57.00%\", \"~\r\n$ tunnel           <dbl> 5.0, 8.6, 7.8, 8.8, 7.4, 7.1, 5.8, 5.1, 4.2~\r\n$ stations         <dbl> 6, 6, 3, 15, 6, 8, 5, 2, 2, 2, 3, 3, 4, 7, ~\r\n$ source1          <chr> \"Plan\", \"Media\", \"Wiki\", \"Plan\", \"Plan\", \"W~\r\n$ cost             <dbl> 2830, 3200, 5500, 8573, 5600, 3100, 4500, 1~\r\n$ currency         <chr> \"CAD\", \"CAD\", \"CAD\", \"CAD\", \"CAD\", \"EUR\", \"~\r\n$ year             <dbl> 2018, 2013, 2018, 2019, 2020, 2009, 2018, 2~\r\n$ ppp_rate         <dbl> 0.840, 0.810, 0.840, 0.840, 0.840, 1.300, 0~\r\n$ real_cost        <chr> \"2377.2\", \"2592\", \"4620\", \"7201.32\", \"4704\"~\r\n$ cost_km_millions <dbl> 417.05263, 301.39535, 592.30769, 464.60129,~\r\n$ source2          <chr> \"Media\", \"Media\", \"Media\", \"Plan\", \"Media\",~\r\n$ reference        <chr> \"https://www.translink.ca/Plans-and-Project~\r\n\r\nThe data set contains twenty variables including start and end date, track length, number of stations, whether it contains a tunnel, and cost recalculated using different measures.\r\nLets map it !\r\nGeocoding with ggmap\r\n\r\n\r\nShow code\r\n\r\nlibrary(ggmap)\r\n\r\nmap <- transit_cost |> \r\n  mutate(city_con = paste0(city, \", \", country)) |> \r\n  group_by(city_con) |> \r\n  count() |> \r\n  mutate_geocode(city_con)\r\n\r\n\r\n\r\nPlotting projects on a world map\r\n\r\n\r\nShow code\r\n\r\nlibrary(rworldmap)\r\n\r\nworldmap <- getMap(resolution = \"coarse\")\r\n\r\n\r\nplot(worldmap, xlim = c(-120, 160), ylim = c(-50, 100), \r\n     asp = 1, bg = \"lightblue\", col = \"black\", fill = T)\r\n\r\npoints(map$lon, map$lat, \r\n       col = rgb(red = 1, green = 0, blue = 0, alpha = 0.8),\r\n       cex = map$n/10,\r\n       pch = 20)\r\n\r\n\r\n\r\n\r\nAverage cost per country\r\nAs mentioned below, the United States is by far the most expensive place to built transit systems. Hopefully we’ll be able to discover exactly why that is, but I have a feeling we’re missing some crucial variables.\r\n\r\n\r\nShow code\r\n\r\ntotal <- transit_cost |> \r\n  group_by(country) |> \r\n  summarize(average_cost = mean(cost_km_millions)) |> \r\n  filter(!is.na(average_cost),\r\n         !is.na(country)) |> \r\n  mutate(us = case_when(\r\n    country == \"US\" ~ \"1\",\r\n    country == \"CN\" ~ \"1\",\r\n    TRUE ~ \"0\"\r\n  ))\r\n\r\ntheme_set(theme_classic())\r\n\r\nggplot(total, aes(x = reorder(country, -average_cost), y = average_cost, fill = us)) +\r\n  geom_bar(stat = \"identity\") +\r\n  scale_fill_manual( values = c( \"1\"=\"red\", \"0\"=\"darkgray\" ), guide = FALSE )+\r\n  labs( x = \"Country\",\r\n        y = \"Average cost per km\",\r\n        title = \"Average rail cost per km by country\",\r\n        subtitle = \"(Millions $USD)\", \r\n        caption = \"Source: Transit Costs Project\") +\r\n  geom_curve(x = 8.5, y = 1100,\r\n             xend = 2, yend = 1000,\r\n             color = \"black\",\r\n             curvature = 0.2,\r\n             size = 1.5,\r\n             arrow = arrow()) +\r\n  annotate(\r\n      \"text\",\r\n      x = 18,\r\n      y = 1000,\r\n      label = expression(\"The United States pays the most\\n in the world per kilometer of rail\\n at $1211.46 million per kilometer\"),\r\n      size = 3.5\r\n   ) +\r\n  geom_curve(x = 40, y = 350,\r\n             xend = 38, yend = 200,\r\n             color = \"black\",\r\n             curvature = 0.2,\r\n             size = 1.5,\r\n             arrow = arrow()) +\r\n  annotate(\r\n      \"text\",\r\n      x = 48,\r\n      y = 350,\r\n      label = expression(\"China only spends on\\n average $184.39 million\"),\r\n      size = 3.5\r\n   ) +\r\n  annotate(\"text\", \r\n           x = 1.2,\r\n           y = -30,\r\n           label = \"US\", \r\n           size = 3.5) +\r\n  annotate(\"text\", \r\n           x = 38,\r\n           y = -30,\r\n           label = \"CN\", \r\n           size = 3.5) +\r\n  theme(\r\n    axis.text.x = element_blank(),\r\n    title = element_text(hjust = 0.5),\r\n    axis.ticks.x=element_blank(),\r\n    axis.line.x = element_blank(),\r\n    axis.line.y = element_blank()\r\n  )\r\n\r\n\r\n\r\n\r\nTotal Lines per country\r\nAlthough I some transit lines are not accounted for in this data set, namely Austin’s red line, it is indisputable that China is the global leader in rail construction over the past 30 years. This partially because China started from an extremely low level of infrastructure and because of Chinese government intervention. Given that the Chinese construction and real estate industries are bordering on insolvency because of over investment, the same may be true for transit. That question we certainly can’t answer from this data set though!\r\n\r\n\r\nShow code\r\n\r\ntotal_lines <- transit_cost |> \r\n  group_by(country) |>\r\n  count() |> \r\n  filter(!is.na(country)) |> \r\n  mutate(us = case_when(\r\n    country == \"CN\" ~ \"1\",\r\n    country == \"US\" ~ \"1\",\r\n    TRUE ~ \"0\"\r\n  ))\r\n\r\nggplot(total_lines, aes(x = reorder(country, -n), y = n, fill = us)) +\r\n  geom_bar(stat = \"identity\") +\r\n  scale_fill_manual( values = c( \"1\"=\"red\", \"0\"=\"darkgray\" ), guide = FALSE ) +\r\n  labs( x = \"Countries\",\r\n        y = \"Rail lines built\",\r\n        title = \"Total rail lines built per country\",\r\n        caption = \"Source: Transit Costs Project\") +\r\n  theme(\r\n    axis.text.x = element_blank(),\r\n    title = element_text(hjust = 0.5),\r\n    axis.ticks.x=element_blank() ,\r\n    axis.line.x = element_blank(),\r\n    axis.line.y = element_blank()\r\n  ) +\r\n  geom_curve(x = 10, y = 175,\r\n             xend = 2, yend = 150,\r\n             color = \"black\",\r\n             curvature = 0.2,\r\n             size = 1.5,\r\n             arrow = arrow()) +\r\n  annotate(\r\n      \"text\",\r\n      x = 17,\r\n      y = 170,\r\n      label = expression(\"By far, China built the\\n most rail since 1990.\"),\r\n      size = 3.5\r\n   ) +\r\n  annotate(\"text\", \r\n           x = 1.3,\r\n           y = -8,\r\n           label = \"CN\", \r\n           size = 3.5) +\r\n  annotate(\"text\", \r\n           x = 8,\r\n           y = -8,\r\n           label = \"US\", \r\n           size = 3.5)\r\n\r\n\r\n\r\n\r\nWhat is causing rail to be so expensive in the US?\r\nLet’s take a deeper look how the different variables are correlated with each other.\r\n\r\n\r\nShow code\r\n\r\ncor <- transit_cost |>\r\n  filter(!is.na(end_year)) |> # this removes 71\r\n  mutate(\r\n    end_year = as.numeric(end_year),\r\n    start_year = as.numeric(start_year),\r\n    real_cost = as.numeric(real_cost),\r\n    total_years = end_year - start_year,\r\n    non_tunnel = length - tunnel\r\n  ) |>\r\n  select(\r\n    -c(\r\n      1:4,\r\n      source1,\r\n      source2,\r\n      reference,\r\n      length,\r\n      tunnel_per,\r\n      cost,\r\n      currency,\r\n      ppp_rate,\r\n      cost_km_millions, \r\n      start_year,\r\n      end_year\r\n    )\r\n  )\r\n\r\n#cor <- na.omit(cor)\r\n\r\nlibrary(corrplot)\r\nCorrelation <- cor(cor, use=\"pairwise.complete.obs\")\r\ncorrplot(Correlation, order = 'hclust', addrect = 2)\r\n\r\n\r\n\r\n\r\nWe can glean from the matrix that both the number of stations and tunnel length were positively correlated with the real cost of the project. We can also see that whether a track is built on an existing railroad is positively correlated with length in years of the project.\r\nLinear Regression\r\nUnfortunately, with the current variables available, we can not make accurate predictions on cost per km, but with real cost as the dependent variable we get some good explanatory power.\r\n\r\n\r\nShow code\r\n\r\nlibrary(tidymodels)\r\n\r\n# Specifying the model \r\nlm_spec <- linear_reg() %>%\r\n  set_mode(\"regression\") %>%\r\n  set_engine(\"lm\")\r\n\r\nlm_fit <- lm_spec %>%\r\n  fit(real_cost ~ ., data = cor)\r\n\r\nlm_fit %>% \r\n  pluck(\"fit\") %>%\r\n  summary()\r\n\r\n\r\n\r\nCall:\r\nstats::lm(formula = real_cost ~ ., data = data)\r\n\r\nResiduals:\r\n    Min      1Q  Median      3Q     Max \r\n-9813.8 -1164.3  -302.1   590.8 17242.8 \r\n\r\nCoefficients:\r\n              Estimate Std. Error t value Pr(>|t|)    \r\n(Intercept) -246142.84   44126.09  -5.578 4.30e-08 ***\r\nrr              592.04     526.69   1.124 0.261609    \r\ntunnel          182.25      12.17  14.971  < 2e-16 ***\r\nstations         61.63      18.30   3.368 0.000825 ***\r\nyear            121.90      21.90   5.566 4.58e-08 ***\r\ntotal_years     123.44      44.23   2.791 0.005486 ** \r\nnon_tunnel       97.47      13.98   6.972 1.18e-11 ***\r\n---\r\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\r\n\r\nResidual standard error: 2684 on 431 degrees of freedom\r\n  (35 observations deleted due to missingness)\r\nMultiple R-squared:  0.6997,    Adjusted R-squared:  0.6956 \r\nF-statistic: 167.4 on 6 and 431 DF,  p-value: < 2.2e-16\r\n\r\nVirtually every variable, besides whether the project was built on a railroad, increased the project costs on average, which makes sense! That’s a no-brainer. The variables are significant, and our R^2 is close to 70%. Now let’s see if our model accurately predicts the real cost .\r\nPrediction\r\nData splitting\r\n\r\n\r\nShow code\r\n\r\nset.seed(27)\r\n\r\ndf <- na.omit(cor)\r\n\r\ndata_split <- initial_split(df, prop = 3/4)\r\n\r\ntrain_data <- training(data_split)\r\ntest_data  <- testing(data_split)\r\n\r\n\r\n\r\nTraining\r\n\r\n\r\nShow code\r\n\r\n# Specifying the model \r\nlm_spec <- linear_reg() %>%\r\n  set_mode(\"regression\") %>%\r\n  set_engine(\"lm\")\r\n\r\n#Fitting \r\nlm_fit <- lm_spec %>%\r\n  fit(real_cost ~ ., data = train_data)\r\n\r\n#Predicting\r\npred <- predict(lm_fit, new_data = test_data)\r\npred\r\n\r\n\r\n# A tibble: 110 x 1\r\n   .pred\r\n   <dbl>\r\n 1 1586.\r\n 2 3068.\r\n 3  777.\r\n 4  359.\r\n 5 1489.\r\n 6 3136.\r\n 7 1429.\r\n 8  902.\r\n 9 1333.\r\n10 1559.\r\n# ... with 100 more rows\r\n\r\nEvaluating\r\n\r\n\r\nShow code\r\n\r\npar(mfrow = c(2, 2)) # plot all 4 plots in one plot\r\nplot(lm_fit$fit,  # Select the fit object from the lm_fit list object \r\n     pch = 16,    # optional parameters to make points blue\r\n     col = '#006EA1')\r\n\r\n\r\n\r\n\r\nBased on the diagnostic tests, there seem to ve several points that are biasing our results. This affects the interpretability and predictive power of our model.\r\nVariable Importance\r\n\r\n\r\nShow code\r\n\r\nvip(lm_fit)\r\n\r\n\r\n\r\n\r\nThe main take away from the variable importance plot is that the length of the track has a huge influence on the track (no brainer), and that tunnels have an even bigger impact (also a no brainer perhaps).\r\nCheck for accuracy\r\n\r\n\r\nShow code\r\n\r\ntest_results <- predict(lm_fit, new_data = test_data) |>\r\n  bind_cols(test_data)\r\n\r\n\r\nprint(rmse(test_results, truth = real_cost, estimate = .pred))\r\n\r\n\r\n# A tibble: 1 x 3\r\n  .metric .estimator .estimate\r\n  <chr>   <chr>          <dbl>\r\n1 rmse    standard       2673.\r\n\r\nShow code\r\n\r\nggplot(data = test_results,\r\n       mapping = aes(x = .pred, y = real_cost)) +\r\n  geom_point(color = '#006EA1') +\r\n  geom_abline(intercept = 0, slope = 1, color = 'orange') +\r\n  labs(title = 'Linear Regression Results - Test Set',\r\n       x = 'Predicted',\r\n       y = 'Real Cost')\r\n\r\n\r\n\r\n\r\nMirroring the diagnostic tests, the model is better when not considering the outliers. Let’s try a different model to improve accuracy.\r\nRandom Forest\r\n\r\n\r\nShow code\r\n\r\nrf_mod <- rand_forest(mode = \"regression\") |> \r\n  set_engine(\"ranger\") \r\n  \r\nprint(rf_mod)\r\n\r\n\r\nRandom Forest Model Specification (regression)\r\n\r\nComputational engine: ranger \r\n\r\nShow code\r\n\r\nrf_fit <- \r\n  rf_mod %>% \r\n  fit(real_cost ~ ., data = train_data)\r\n\r\nprint(rf_fit)\r\n\r\n\r\nparsnip model object\r\n\r\nFit time:  591ms \r\nRanger result\r\n\r\nCall:\r\n ranger::ranger(x = maybe_data_frame(x), y = y, num.threads = 1,      verbose = FALSE, seed = sample.int(10^5, 1)) \r\n\r\nType:                             Regression \r\nNumber of trees:                  500 \r\nSample size:                      328 \r\nNumber of independent variables:  6 \r\nMtry:                             2 \r\nTarget node size:                 5 \r\nVariable importance mode:         none \r\nSplitrule:                        variance \r\nOOB prediction error (MSE):       10487881 \r\nR squared (OOB):                  0.5995448 \r\n\r\nShow code\r\n\r\ntest_results <- predict(rf_fit, new_data = test_data) |>\r\n  bind_cols(test_data)\r\n\r\nprint(rmse(test_results, truth = real_cost, estimate = .pred))\r\n\r\n\r\n# A tibble: 1 x 3\r\n  .metric .estimator .estimate\r\n  <chr>   <chr>          <dbl>\r\n1 rmse    standard       2649.\r\n\r\nShow code\r\n\r\nggplot(data = test_results,\r\n       mapping = aes(x = .pred, y = real_cost)) +\r\n  geom_point(color = '#006EA1') +\r\n  geom_abline(intercept = 0, slope = 1, color = 'orange') +\r\n  labs(title = 'RF Regression Results - Test Set',\r\n       x = 'Predicted',\r\n       y = 'Real Cost')\r\n\r\n\r\n\r\n\r\nBased on the results, both of them are particularly good. Accordingly, our data set lacks certain variables that might impact the overal cost of a metro rail project.\r\n\r\n\r\n\r\n",
    "preview": "posts/2022-01-04-transit-costs-project/transit-costs-project_files/figure-html5/plot_map-1.png",
    "last_modified": "2022-01-11T11:35:52-06:00",
    "input_file": "transit-costs-project.knit.md"
  },
  {
    "path": "posts/welcome/",
    "title": "Welcome to Tensor Tenison",
    "description": "Welcome to my new blog, Tensor Tenison. I hope you enjoy reading about and viewing my work.\nIn my line of work, I'm constantly working on a multitude of different projects.\nThis blog is my attempt to tie everything together in a digestistable format to serve\nas a portfolio of my work.",
    "author": [
      {
        "name": "Ethan Tenison",
        "url": "https://twitter.com/ethantenison"
      }
    ],
    "date": "2022-01-02",
    "categories": [],
    "contents": "\r\n\r\n\r\n\r\n",
    "preview": {},
    "last_modified": "2022-01-04T12:58:14-06:00",
    "input_file": {}
  }
]
